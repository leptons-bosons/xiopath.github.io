<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Path MTU Discovery (PMTUD) is a standardized technique in computer networking for determining the maximum transmission unit (MTU) size on the network path between two Internet Protocol (IP) hosts, usu">
<meta name="keywords" content="protocol,Path MTU">
<meta property="og:type" content="article">
<meta property="og:title" content="Path MTU Discovery">
<meta property="og:url" content="xvirt.ink/2018/02/20/path-MTU-discovery/index.html">
<meta property="og:site_name" content="xvirt">
<meta property="og:description" content="Path MTU Discovery (PMTUD) is a standardized technique in computer networking for determining the maximum transmission unit (MTU) size on the network path between two Internet Protocol (IP) hosts, usu">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-08-28T14:53:16.262Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Path MTU Discovery">
<meta name="twitter:description" content="Path MTU Discovery (PMTUD) is a standardized technique in computer networking for determining the maximum transmission unit (MTU) size on the network path between two Internet Protocol (IP) hosts, usu">
    
    
        
          
              <link rel="shortcut icon" href="/images/cherry_256.png">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/cherry_android_192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/cherry_apple.png">
          
        
    
    <!-- title -->
    <title>Path MTU Discovery</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives">Posts</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/02/21/tcp-syn-packet/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/02/19/tcp-ip/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=xvirt.ink/2018/02/20/path-MTU-discovery/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=xvirt.ink/2018/02/20/path-MTU-discovery/&text=Path MTU Discovery"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=xvirt.ink/2018/02/20/path-MTU-discovery/&title=Path MTU Discovery"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=xvirt.ink/2018/02/20/path-MTU-discovery/&is_video=false&description=Path MTU Discovery"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Path MTU Discovery&body=Check out this article: xvirt.ink/2018/02/20/path-MTU-discovery/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=xvirt.ink/2018/02/20/path-MTU-discovery/&title=Path MTU Discovery"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=xvirt.ink/2018/02/20/path-MTU-discovery/&title=Path MTU Discovery"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=xvirt.ink/2018/02/20/path-MTU-discovery/&title=Path MTU Discovery"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=xvirt.ink/2018/02/20/path-MTU-discovery/&title=Path MTU Discovery"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=xvirt.ink/2018/02/20/path-MTU-discovery/&name=Path MTU Discovery&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Path-MTU-Discovery-with-UDP"><span class="toc-number">1.</span> <span class="toc-text">Path MTU Discovery with UDP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Path-MTU-Discovery-with-TCP"><span class="toc-number">2.</span> <span class="toc-text">Path MTU Discovery with TCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Problems"><span class="toc-number">3.</span> <span class="toc-text">Problems</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Path MTU Discovery
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">xvirt</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-02-20T08:03:28.000Z" itemprop="datePublished">2018-02-20</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Path-MTU/">Path MTU</a>, <a class="tag-link" href="/tags/protocol/">protocol</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Path MTU Discovery (PMTUD) is a standardized technique in computer networking for determining the maximum transmission unit (MTU) size on the network path between two Internet Protocol (IP) hosts, usually with the goal of avoiding IP fragmentation. IPv4 <a href="https://tools.ietf.org/html/rfc1191" target="_blank" rel="noopener">RFC1191</a> and IPv6 <a href="https://tools.ietf.org/html/rfc1981" target="_blank" rel="noopener">RFC1981</a>.</p>
<h3 id="Path-MTU-Discovery-with-UDP"><a href="#Path-MTU-Discovery-with-UDP" class="headerlink" title="Path MTU Discovery with UDP"></a>Path MTU Discovery with UDP</h3><p>For a protocol such as UDP, in which the calling application is generally in control of the outgoing datagram size, it is useful if there is some way to determine an appropriate datagram size if fragmentation is to be avoided. Conventional PMTUD uses ICMP PTB messages in determining the largest packet size along a routing path that can be used without inducing fragmentation. These messages are typically processed below the UDP layer and are not directly visible to an application, so either an API call is used for the application to learn the best current estimate of the path MTU size for each destination with which it has communicated, or the IP layer can perform PMTUD independently without the application knowing. The IP layer often caches PMTUD information on a per-destination basis and times it out if it is not refreshed.</p>
<h3 id="Path-MTU-Discovery-with-TCP"><a href="#Path-MTU-Discovery-with-TCP" class="headerlink" title="Path MTU Discovery with TCP"></a>Path MTU Discovery with TCP</h3><p>How PMTUD is used by TCP? TCP’s regular PMTUD process operates as follows: When a connection is established, TCP uses the minimum of the MTU of the outgoing interface, or the MSS announced by the other end, as the basis for selecting its send maximum segment size (SMSS). PMTUD does not allow TCP to exceed the MSS announced by the other end. If the other end does not specify an MSS, the sender assumes a default of 536 bytes, but this situation is now rare. It is also possible for an implementation to save path MTU information on a per-destination basis to help in selecting its segment size. <em>Note that the path MTU in each direction of a connection could be different</em>.</p>
<p>Once the initial SMSS is chosen, all IPv4 datagrams sent by TCP on that connection have the IPv4 DF bit field set. For TCP/IPv6, this is not necessary because there is no DF bit field; all datagrams are assumed to have it set implicitly. If a PTB(packet too big) is received, TCP decreases the segment size and retransmits using a different segment size. If the PTB contains the suggested next-hop MTU, the segment size can be set to the next-hop MTU minus the sizes of the IPv4 (or IPv6) and TCP headers. If the next-hop MTU value is not present (e.g., an older ICMP error was returned that lacks this information), the sender may try a variety of values (e.g., binary search for a usable value). This also affects TCP’s congestion control management. For PLPMTUD(Packetization Layer Path MTU Discovery), <a href="https://tools.ietf.org/html/rfc4821" target="_blank" rel="noopener">RFC4821</a>, the situation is similar, except PTB messages are not used. Instead, the protocol performing PMTUD must be able to detect message discards quickly and perform its own datagram size adjustments.<br>Because routes can change dynamically, when some time has passed since the last decrease of the segment size, a larger value (up to the initial SMSS) can be tried. Guidance in <a href="https://tools.ietf.org/html/rfc1191" target="_blank" rel="noopener">RFC1191</a> and <a href="https://tools.ietf.org/html/rfc1981" target="_blank" rel="noopener">RFC1981</a> recommends that this time interval be about 10 minutes.</p>
<h3 id="Problems"><a href="#Problems" class="headerlink" title="Problems"></a>Problems</h3><p>Many network security devices block all ICMP messages for perceived security benefits, including the errors that are necessary for the proper operation of PMTUD. This can result in connections that complete the TCP three-way handshake correctly, but then hang when data is transferred. This state is referred to as a <em>black hole</em> connection.</p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives">Posts</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Path-MTU-Discovery-with-UDP"><span class="toc-number">1.</span> <span class="toc-text">Path MTU Discovery with UDP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Path-MTU-Discovery-with-TCP"><span class="toc-number">2.</span> <span class="toc-text">Path MTU Discovery with TCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Problems"><span class="toc-number">3.</span> <span class="toc-text">Problems</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=xvirt.ink/2018/02/20/path-MTU-discovery/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=xvirt.ink/2018/02/20/path-MTU-discovery/&text=Path MTU Discovery"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=xvirt.ink/2018/02/20/path-MTU-discovery/&title=Path MTU Discovery"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=xvirt.ink/2018/02/20/path-MTU-discovery/&is_video=false&description=Path MTU Discovery"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Path MTU Discovery&body=Check out this article: xvirt.ink/2018/02/20/path-MTU-discovery/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=xvirt.ink/2018/02/20/path-MTU-discovery/&title=Path MTU Discovery"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=xvirt.ink/2018/02/20/path-MTU-discovery/&title=Path MTU Discovery"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=xvirt.ink/2018/02/20/path-MTU-discovery/&title=Path MTU Discovery"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=xvirt.ink/2018/02/20/path-MTU-discovery/&title=Path MTU Discovery"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=xvirt.ink/2018/02/20/path-MTU-discovery/&name=Path MTU Discovery&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2021 Henry
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives">Posts</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-37473492-6', 'auto');
        ga('send', 'pageview');
    </script>



