<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Terminology Passing arguments: “passing arguments” is a way of saying that the calling function is writing data in the place where the called function will look for them. Arguments are passed before t">
<meta name="keywords" content="calling conventions">
<meta property="og:type" content="article">
<meta property="og:title" content="Function Calling Conventions">
<meta property="og:url" content="xvirt.ink/2018/12/26/function-calling-conventions/index.html">
<meta property="og:site_name" content="xvirt">
<meta property="og:description" content="Terminology Passing arguments: “passing arguments” is a way of saying that the calling function is writing data in the place where the called function will look for them. Arguments are passed before t">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-12-26T14:11:14.013Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Function Calling Conventions">
<meta name="twitter:description" content="Terminology Passing arguments: “passing arguments” is a way of saying that the calling function is writing data in the place where the called function will look for them. Arguments are passed before t">
    
    
        
          
              <link rel="shortcut icon" href="/images/cherry_256.png">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/cherry_android_192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/cherry_apple.png">
          
        
    
    <!-- title -->
    <title>Function Calling Conventions</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives">Posts</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019/10/02/design-patterns/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/12/16/qemu-kvm/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=xvirt.ink/2018/12/26/function-calling-conventions/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=xvirt.ink/2018/12/26/function-calling-conventions/&text=Function Calling Conventions"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=xvirt.ink/2018/12/26/function-calling-conventions/&title=Function Calling Conventions"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=xvirt.ink/2018/12/26/function-calling-conventions/&is_video=false&description=Function Calling Conventions"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Function Calling Conventions&body=Check out this article: xvirt.ink/2018/12/26/function-calling-conventions/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=xvirt.ink/2018/12/26/function-calling-conventions/&title=Function Calling Conventions"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=xvirt.ink/2018/12/26/function-calling-conventions/&title=Function Calling Conventions"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=xvirt.ink/2018/12/26/function-calling-conventions/&title=Function Calling Conventions"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=xvirt.ink/2018/12/26/function-calling-conventions/&title=Function Calling Conventions"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=xvirt.ink/2018/12/26/function-calling-conventions/&name=Function Calling Conventions&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Terminology"><span class="toc-number">1.</span> <span class="toc-text">Terminology</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stack-Frame"><span class="toc-number">2.</span> <span class="toc-text">Stack Frame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reference"><span class="toc-number">3.</span> <span class="toc-text">Reference</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Function Calling Conventions
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">xvirt</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-12-26T12:56:13.000Z" itemprop="datePublished">2018-12-26</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/calling-conventions/">calling conventions</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="Terminology"><a href="#Terminology" class="headerlink" title="Terminology"></a>Terminology</h3><ul>
<li>Passing arguments: “passing arguments” is a way of saying that the calling function is writing data in the place where the called function will look for them. Arguments are passed before the call instruction is executed.</li>
<li><p>Right-to-Left and Left-to-Right: describe the manner that arguments are passed to the subroutine, in terms of the High-level code. For instance, the following C function call:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MyFunction1(a, b);</span><br><span class="line">//will generate the following code if passed Left-to-Right:</span><br><span class="line">push a</span><br><span class="line">push b</span><br><span class="line">call _MyFunction</span><br><span class="line">//and will generate the following code if passed Right-to-Left:</span><br><span class="line">push b</span><br><span class="line">push a</span><br><span class="line">call _MyFunction</span><br></pre></td></tr></table></figure>
</li>
<li><p>Return value: Some functions return a value, and that value must be received reliably by the function’s caller. The called function places its return value in a place where the calling function can get it when execution returns. The called function stores the return value before executing the ret instruction.</p>
</li>
<li>Cleaning the stack: when arguments are pushed onto the stack, eventually they must be popped back off again. Whichever function, the caller or the callee, is responsible for cleaning the stack must reset the stack pointer to eliminate the passed arguments.</li>
<li>Calling function (the caller): The “parent” function that calls the subroutine. Execution resumes in the calling function directly after the subroutine call, unless the program terminates inside the subroutine.</li>
<li>Called function (the callee): The “child” function that gets called by the “parent”.</li>
<li>Name Decoration: When C code is translated to assembly code, the compiler will often “decorate” the function name by adding extra information that the linker will use to find and link to the correct functions. For most calling conventions, the decoration is very simple (often only an extra symbol or two to denote the calling convention), but in some extreme cases (notably C++ “thiscall” convention), the names are “mangled” severely.</li>
<li>Entry sequence (the function prologue): a few instructions at the beginning of a function, which prepare the stack and registers for use within the function.</li>
<li>Exit sequence (the function epilogue): a few instructions at the end of a function, which restore the stack and registers to the state expected by the caller, and return to the caller. Some calling conventions clean the stack in the exit sequence.</li>
<li>Call sequence: a few instructions in the middle of a function (the caller) which pass the arguments and call the called function. After the called function has returned, some calling conventions have one more instruction in the call sequence to clean the stack.</li>
</ul>
<h3 id="Stack-Frame"><a href="#Stack-Frame" class="headerlink" title="Stack Frame"></a>Stack Frame</h3><ul>
<li><p>Example Code, sum_till_max.c</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line">#define MAX (1UL &lt;&lt; 20)</span><br><span class="line"></span><br><span class="line">typedef unsigned long long u64;</span><br><span class="line">typedef unsigned int u32;</span><br><span class="line"></span><br><span class="line">u32 max_add_end = MAX;</span><br><span class="line"></span><br><span class="line">u64 sum_till_max(u32 n)</span><br><span class="line">&#123;</span><br><span class="line">  u64 sum;</span><br><span class="line">  n++;</span><br><span class="line">  sum = n;</span><br><span class="line"></span><br><span class="line">  if (n &lt; max_add_end)</span><br><span class="line">    sum += sum_till_max(n);</span><br><span class="line"></span><br><span class="line">  return sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">  u64 sum = 0;</span><br><span class="line"></span><br><span class="line">  if ((argc == 2) &amp;&amp; isdigit(*argv[1]))</span><br><span class="line">    max_add_end = strtoul(argv[1], NULL, 0);</span><br><span class="line"></span><br><span class="line">  if (max_add_end &gt; MAX || max_add_end == 0) &#123;</span><br><span class="line">    fprintf(stderr, &quot;Invalid number is specified\n&quot;);</span><br><span class="line">    return 1;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  sum = sum_till_max(0);</span><br><span class="line">  printf(&quot;sum(0...%u) = %llu\n&quot;, max_add_end, sum);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Content Assemble Code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disassemble main </span><br><span class="line">Dump of assembler code for function main:</span><br><span class="line">   0x000000000040069b &lt;+0&gt;:	push   %rbp</span><br><span class="line">   0x000000000040069c &lt;+1&gt;:	mov    %rsp,%rbp</span><br><span class="line">   0x000000000040069f &lt;+4&gt;:	sub    $0x20,%rsp</span><br><span class="line">...</span><br><span class="line">   0x0000000000400744 &lt;+169&gt;:	jmp    0x400774 &lt;main+217&gt;</span><br><span class="line">   0x0000000000400746 &lt;+171&gt;:	mov    $0x0,%edi ----------------------------------------------------#1</span><br><span class="line">   0x000000000040074b &lt;+176&gt;:	callq  0x400666 &lt;sum_till_max&gt; --------------------------------------#2</span><br><span class="line">   0x0000000000400750 &lt;+181&gt;:	mov    %rax,-0x8(%rbp)</span><br><span class="line">   0x0000000000400754 &lt;+185&gt;:	mov    0x2008f6(%rip),%eax        # 0x601050 &lt;max_add_end&gt;</span><br><span class="line">...</span><br><span class="line">(gdb) disassemble sum_till_max </span><br><span class="line">Dump of assembler code for function sum_till_max:</span><br><span class="line">   0x0000000000400666 &lt;+0&gt;: 	push   %rbp ---------------------------------------------------------#3</span><br><span class="line">   0x0000000000400667 &lt;+1&gt;: 	mov    %rsp,%rbp ----------------------------------------------------#4</span><br><span class="line">   0x000000000040066a &lt;+4&gt;: 	sub    $0x20,%rsp ---------------------------------------------------#5</span><br><span class="line">   0x000000000040066e &lt;+8&gt;: 	mov    %edi,-0x14(%rbp)</span><br><span class="line">   0x0000000000400671 &lt;+11&gt;:	addl   $0x1,-0x14(%rbp) ---------------------------------------------#6</span><br><span class="line">   0x0000000000400675 &lt;+15&gt;:	mov    -0x14(%rbp),%eax</span><br><span class="line">   0x0000000000400678 &lt;+18&gt;:	mov    %rax,-0x8(%rbp)</span><br><span class="line">   0x000000000040067c &lt;+22&gt;:	mov    0x2009ce(%rip),%eax        # 0x601050 &lt;max_add_end&gt;</span><br><span class="line">   0x0000000000400682 &lt;+28&gt;:	cmp    %eax,-0x14(%rbp)</span><br><span class="line">   0x0000000000400685 &lt;+31&gt;:	jae    0x400695 &lt;sum_till_max+47&gt;</span><br><span class="line">   0x0000000000400687 &lt;+33&gt;:	mov    -0x14(%rbp),%eax</span><br><span class="line">   0x000000000040068a &lt;+36&gt;:	mov    %eax,%edi</span><br><span class="line">   0x000000000040068c &lt;+38&gt;:	callq  0x400666 &lt;sum_till_max&gt;</span><br><span class="line">   0x0000000000400691 &lt;+43&gt;:	add    %rax,-0x8(%rbp)</span><br><span class="line">   0x0000000000400695 &lt;+47&gt;:	mov    -0x8(%rbp),%rax</span><br><span class="line">   0x0000000000400699 &lt;+51&gt;:	leaveq --------------------------------------------------------------#7</span><br><span class="line">   0x000000000040069a &lt;+52&gt;:	retq ----------------------------------------------------------------#8</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://manybutfinite.com/post/journey-to-the-stack/" target="_blank" rel="noopener">journey to the stack</a></li>
<li><a href="https://en.wikibooks.org/wiki/X86_Disassembly/Calling_Conventions" target="_blank" rel="noopener">x86 Disassembly/Calling Conventions</a></li>
</ul>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives">Posts</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Terminology"><span class="toc-number">1.</span> <span class="toc-text">Terminology</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stack-Frame"><span class="toc-number">2.</span> <span class="toc-text">Stack Frame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reference"><span class="toc-number">3.</span> <span class="toc-text">Reference</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=xvirt.ink/2018/12/26/function-calling-conventions/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=xvirt.ink/2018/12/26/function-calling-conventions/&text=Function Calling Conventions"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=xvirt.ink/2018/12/26/function-calling-conventions/&title=Function Calling Conventions"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=xvirt.ink/2018/12/26/function-calling-conventions/&is_video=false&description=Function Calling Conventions"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Function Calling Conventions&body=Check out this article: xvirt.ink/2018/12/26/function-calling-conventions/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=xvirt.ink/2018/12/26/function-calling-conventions/&title=Function Calling Conventions"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=xvirt.ink/2018/12/26/function-calling-conventions/&title=Function Calling Conventions"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=xvirt.ink/2018/12/26/function-calling-conventions/&title=Function Calling Conventions"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=xvirt.ink/2018/12/26/function-calling-conventions/&title=Function Calling Conventions"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=xvirt.ink/2018/12/26/function-calling-conventions/&name=Function Calling Conventions&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 Henry
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives">Posts</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-37473492-6', 'auto');
        ga('send', 'pageview');
    </script>



